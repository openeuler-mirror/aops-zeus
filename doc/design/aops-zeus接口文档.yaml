swagger: '2.0'
info:
  version: v1
  title: ApplicationTitle
  description: GroupDesc
schemes:
  - https
host: localhost.com
basePath: /
tags:
  - name: account
    description: |
      token认证
  - name: host_manage
  - name: host_group
  - name: scene
  - name: config_manager
  - name: agent_manager
  - name: vulnerability_manager
  - name: metric
paths:
  /manage/account/user/add:
    post:
      tags:
        - account
      description: 添加用户
      operationId: AddUser
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: username
          in: formData
          required: true
          description: 用户名
          type: string
        - name: password
          in: formData
          required: true
          description: 密码
          type: string
        - name: email
          type: string
          in: formData
          required: true
          description: 邮箱地址
      responses:
        '200':
          description: 添加用户响应
          schema:
            $ref: '#/definitions/OperateSuccess'
      x-apidesigner: 0
  /manage/account/login:
    post:
      tags:
        - account
      description: 用户登录
      operationId: login
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: username
          in: formData
          required: true
          description: 用户名
          type: string
        - name: password
          in: formData
          required: true
          description: 登录密码
          type: string
      responses:
        '200':
          description: 用户登录响应
          schema:
            $ref: '#/definitions/UserLoginRsp'
      x-apidesigner: 1
  /manage/account/change:
    post:
      tags:
        - account
      description: 修改密码
      operationId: ChangePassword
      parameters:
        - name: password
          in: query
          required: true
          description: 修改后的密码
          type: string
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 修改密码响应
          schema:
            $ref: '#/definitions/OperateSuccess'
      x-apidesigner: 2
  /manage/account/authredirecturl:
    get:
      tags:
        - account
      description: gitee授权登录跳转
      operationId: Authredirecturl
      responses:
        '200':
          description: gitee授权登录跳转的响应
          schema:
            $ref: '#/definitions/AuthRedirectSuccess'
      x-apidesigner: 2
  /manage/account/gitee/login:
    post:
      tags:
        - account
      description: gitee授权登录
      operationId: GiteeLogin
      parameters:
        - name: code
          in: query
          required: true
          description: gitee登录后的授权码
          type: string
      responses:
        '200':
          description: gitee登录响应
          schema:
            $ref: '#/definitions/UserLoginRsp'
      x-apidesigner: 2
  /manage/account/bindaccount:
    post:
      tags:
        - account
      description: 本地用户和鉴权用户绑定
      operationId: BindAccount
      parameters:
        - name: username
          in: query
          required: true
          description: 本地用户名
          type: string
        - name: auth_account
          in: query
          required: true
          description: 第三方鉴权用户名
          type: string
        - name: password
          in: query
          required: true
          description: 本地用户密码
          type: string
      responses:
        '200':
          description: 用户绑定响应
          schema:
            $ref: '#/definitions/UserLoginRsp'
      x-apidesigner: 2
  /manage/host/add:
    post:
      tags:
        - host_manage
      summary: 添加主机
      description: 添加主机
      operationId: add_host
      deprecated: false
      parameters:
        - name: AddHostReq
          in: body
          required: true
          description: 添加主机请求
          schema:
            $ref: '#/definitions/AddHostReq'
      responses:
        '200':
          description: 添加主机响应
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/host/update:
    post:
      tags:
        - host_manage
      description: 更新主机
      operationId: update_host
      summary: 更新主机
      deprecated: false
      parameters:
        - name: UpdateHostReq
          in: body
          required: true
          description: 更新主机请求
          schema:
            $ref: '#/definitions/UpdateHostReq'
      responses:
        '200':
          description: 更新主机响应
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/host/add/batch:
    post:
      tags:
        - host_manage
      description: 批量添加主机
      operationId: add_host_batch
      deprecated: false
      summary: 批量添加主机
      consumes:
        - application/json
      parameters:
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: false
        - name: AddHostBatchReq
          in: body
          required: true
          schema:
            $ref: '#/definitions/AddHostBatchReq'
      responses:
        '200':
          description: 批量添加主机响应
          schema:
            $ref: '#/definitions/AddHostBatchRsp'
  /manage/host/file/template:
    get:
      tags:
        - host_manage
      summary: 批量添加主机文件模板下载
      description: 批量添加主机文件模板下载
      operationId: get_host_template_file
      parameters:
        - in: header
          name: access_token
          description: 授权码
          type: string
          required: true
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/host_template_file'
  /manage/host/get:
    post:
      tags:
        - host_manage
      description: 获取指定主机信息（列表）
      operationId: get_host_list
      parameters:
        - name: GetHost
          in: body
          required: true
          description: 获取主机列表请求
          schema:
            $ref: '#/definitions/GetHostListReq'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 获取主机列表响应
          schema:
            $ref: '#/definitions/GetHostListRsp'
  /manage/host/info/query:
    post:
      tags:
        - host_manage
      description: 查询指定主机详细信息
      operationId: query_host_info
      consumes:
        - application/json
      parameters:
        - name: host_list
          in: body
          required: true
          description: 需要查询主机信息的ID列表
          schema:
            properties:
              host_list:
                type: array
                items:
                  type: integer
              basic:
                type: boolean
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 获取主机基本信息响应
          schema:
            $ref: '#/definitions/GetHostBasicInfoRsp'
  /manage/host/delete:
    delete:
      tags:
        - host_manage
      description: 删除主机
      operationId: delete_host
      parameters:
        - name: host_list
          in: body
          required: true
          description: 要删除的主机id列表
          schema:
            type: array
            items:
              type: integer
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 删除主机响应
          schema:
            $ref: '#/definitions/DeleteHostRsp'
  /manage/host/group/add:
    post:
      tags:
        - host_group
      description: 添加主机组
      operationId: add_host_group
      parameters:
        - name: AddHostReq
          in: body
          required: true
          description: 添加主机组请求
          schema:
            $ref: '#/definitions/AddHostGroupInfoReq'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 添加主机组响应
          schema:
            $ref: '#/definitions/AddHostGroupInfoRsp'
  /manage/host/group/get:
    post:
      tags:
        - host_group
      description: 查询主机组
      operationId: get_host_group
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: sort
          in: formData
          required: false
          description: 目前可选host_group_name或host_count，为空表示不排序
          type: string
          enum:
            - host_group_name
            - host_count
        - name: direction
          in: formData
          required: false
          description: 升序(asc)，降序(desc)，默认:asc
          type: string
          default: asc
          enum:
            - asc
            - desc
        - name: page
          in: formData
          required: false
          description: 当前的页码
          type: integer
          format: int32
          minimum: 0
        - name: per_page
          in: formData
          required: false
          description: 每页的数量，最大为50
          type: integer
          format: int32
          minimum: 1
          maximum: 50
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 获取主机组信息响应
          schema:
            $ref: '#/definitions/GetHostGroupInfoRsp'
  /manage/host/group/delete:
    delete:
      tags:
        - host_group
      description: 删除主机组
      operationId: delete_host_group
      parameters:
        - name: host_group_list
          in: body
          required: true
          description: 删除主机组列表
          schema:
            type: array
            items:
              type: string
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 删除主机列表响应
          schema:
            $ref: '#/definitions/DeleteGroupRsp'
  /manage/host/scene/get:
    get:
      tags:
        - scene
      description: 查询主机场景与推荐采集指标
      operationId: get_host_scene
      parameters:
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
        - name: host_id
          in: query
          required: false
          type: integer
      responses:
        '200':
          description: 查询主机场景响应
          schema:
            $ref: '#/definitions/HostSceneInfoRsp'
  /manage/host/scene/list:
    post:
      tags:
        - scene
      description: 查询主机场景列表
      operationId: GetHostSceneList
      consumes:
        - application/x-www-form-urlencoded
      deprecated: true
      parameters:
        - name: sort
          in: formData
          required: false
          description: 目前可选scene_name,为空表示不排序
          type: string
          default: scene_name
        - name: direction
          in: formData
          required: false
          description: 升序(asc)，降序(desc)，默认:asc
          type: string
          default: asc
          enum:
            - asc
            - desc
        - name: page
          in: formData
          required: false
          description: 当前的页码
          type: integer
          format: int32
          minimum: 1
          exclusiveMinimum: true
        - name: per_page
          in: formData
          required: false
          description: 每页的数量，最大为50
          type: integer
          format: int32
          minimum: 1
          maximum: 50
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 获取场景列表响应
          schema:
            $ref: '#/definitions/SceneListRsp'
  /manage/config/collect:
    post:
      tags:
        - config_manager
      description: 收集主机配置文件信息
      operationId: get_config
      parameters:
        - name: ConfigList
          in: body
          required: true
          description: 配置文件收集请求
          schema:
            $ref: '#/definitions/ConfigList'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 配置文件收集响应
          schema:
            $ref: '#/definitions/ConfigListRsp'
  /manage/config/sync:
    post:
      tags:
        - config_manager
      description: 同步文本内容至指定配置文件
      operationId: sync_config
      parameters:
        - name: SyncConfigInfo
          in: body
          required: true
          description: 需要同步的文件内容以及目标机器
          schema:
            $ref: '#/definitions/SyncConfigReq'
      responses:
        '200':
          description: 文件同步响应
          schema:
            $ref: '#/definitions/SyncConfigRsp'
  /manage/agent/plugin/set:
    post:
      tags:
        - agent_manager
      description: 设置agent插件状态
      operationId: set_plugin_status
      parameters:
        - name: SetAgentServiceStatusReq
          in: body
          required: true
          description: 设置agent服务信息
          schema:
            $ref: '#/definitions/SetAgentServiceStatusReq'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 设置agent服务响应
          schema:
            $ref: '#/definitions/SetAgentServiceStatusRsp'
  /manage/agent/service/resource/set:
    post:
      tags:
        - agent_manager
      description: 设置agent服务的资源消耗
      operationId: SetAgentServiceResource
      deprecated: true
      parameters:
        - name: SetAgentServiceResourceReq
          in: body
          required: true
          description: 设置agent服务资源限制请求
          schema:
            $ref: '#/definitions/SetAgentServiceResourceReq'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 设置agent服务的资源消耗响应
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/agent/metric/set:
    post:
      tags:
        - agent_manager
      description: 设置agent采集项状态
      operationId: set_plugin_probe
      parameters:
        - name: SetAgentServiceMetricStatus
          in: body
          required: true
          description: 设置agent服务采集项状态
          schema:
            $ref: '#/definitions/SetAgentServiceMetricStatus'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 设置Agent采集项状态响应
          schema:
            $ref: '#/definitions/SetAgentPluginProbeRsp'
  /manage/host/count:
    post:
      tags:
        - host_manage
      summary: 查询主机数量
      operationId: get_host_count
      description: 查询主机数量
      parameters:
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 主机数量
          schema:
            $ref: '#/definitions/GetHostCountRsp'
  /manage/host/token/query:
    get:
      tags:
        - host_manage
      description: 查询主机token
      operationId: GetHostToken
      deprecated: true
      parameters:
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GetHostTokenRsp'
  /manage/agent/plugin/install:
    post:
      tags:
        - agent_manager
      description: 安装agent插件
      operationId: InstallAgentPlugin
      deprecated: true
      parameters:
        - name: InstallAgentPluginReq
          in: body
          required: true
          description: 安装插件请求
          schema:
            $ref: '#/definitions/InstallAgentPluginReq'
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
      responses:
        '200':
          description: 安装插件响应
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/uninstall/plugin:
    post:
      tags:
        - agent_manager
      description: 卸载插件
      operationId: UninstallAgentPlugin
      deprecated: true
      parameters:
        - name: plugin_list
          in: body
          required: true
          description: 插件列表
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: 卸载插件响应
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/agent/plugin/info:
    get:
      tags:
        - agent_manager
      description: 获取agent插件运行信息
      operationId: get_plugin_info
      parameters:
        - name: access_token
          in: header
          required: true
          description: 授权码
          type: string
        - name: host_id
          in: query
          required: false
          description: 主机id
          type: integer
      responses:
        '200':
          description: 获取插件运行信息响应
          schema:
            $ref: '#/definitions/GetAgentPluginInfoRsp'
  /manage/vulnerability/repo/set/:
    post:
      tags:
        - vulnerability_manager
      operationId: execute_repo_set_task
      produces:
        - application/json
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: task
          in: body
          required: true
          description: 任务信息
          schema:
            $ref: '#/definitions/RepoSetReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/vulnerability/cve/scan:
    post:
      tags:
        - vulnerability_manager
      operationId: execute_cve_scan_task
      produces:
        - application/json
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: task
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveScanReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/vulnerability/cve/fix:
    post:
      tags:
        - vulnerability_manager
      operationId: execute_cve_fix_task
      produces:
        - application/json
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: task
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveFixReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/vulnerability/cve/rollback:
    post:
      tags:
        - vulnerability_manager
      operationId: execute_cve_rollback_task
      produces:
        - application/json
      parameters:
        - name: access_token
          in: header
          required: false
          type: string
        - name: task
          in: body
          required: false
          schema:
            $ref: '#/definitions/CveRollBackReq'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/OperateSuccess'
  /manage/host/metric/data:
    post:
      tags:
        - metric
      description: 给定时间范围和指标信息，查看相关指标数据
      operationId: query_metric_data
      parameters:
        - name: query_info
          in: body
          required: true
          description: 查询列表
          schema:
            $ref: '#/definitions/QueryMetricDataInfo'
        - name: access_token
          in: header
          required: true
          type: string
      responses:
        '200':
          description: 查询数据结果
          schema:
            additionalProperties:
              type: string
            type: object
          examples:
            application/json:
              code: 200
              msg: operation succeed
              results:
                metric1:
                  'metric1{label1="label1_value1", label2="label2_value1", ...., }':
                    - - 1665521492
                      - '8'
                    - - 1665521507
                      - '0'
                  'metric1{label1="label1_value2", label2="label2_value2", ...., }':
                    - - 1665521492
                      - '8'
                    - - 1665521507
                      - '0'
                metric2:
                  'metric2{label1="label1_value1", label2="label2_value1", ...., }':
                    - - 1665521492
                      - '8'
                    - - 1665521507
                      - '0'
                  'metric2{label1="label1_value2", label2="label2_value2", ...., }':
                    - - 1665521492
                      - '8'
                    - - 1665521507
                      - '0'
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /manage/host/metric/names:
    get:
      tags:
        - metric
      description: 查询主机指标名
      operationId: query_metric_names
      parameters:
        - name: query_ip
          in: query
          required: true
          description: 查询主机ip
          type: string
        - name: access_token
          in: header
          required: true
          type: string
      responses:
        '200':
          description: 返回指标列表查询结果
          schema:
            items:
              type: string
            type: array
          examples:
            application/json:
              code: 200
              msg: operation succeed
              results:
                - metric1
                - metric2
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
  /manage/host/metric/list:
    post:
      tags:
        - metric
      description: 给定指标名，返回带标签的指标信息
      operationId: query_metric_list
      parameters:
        - name: access_token
          in: header
          required: true
          type: string
        - name: metric_names
          in: body
          required: true
          description: 指标名
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: 带标签的指标信息
          schema:
            type: array
            items:
              type: string
          examples:
            application/json:
              code: 200
              msg: operation succeed
              results:
                metric1:
                  - >-
                    metric1{label1="label1_value", label2="label2_value", ....,
                    }
                  - >-
                    metric1{label1="label1_value", label2="label2_value", ....,
                    }
                metric2:
                  - >-
                    metric2{label1="label1_value", label2="label2_value", ....,
                    }
                  - >-
                    metric2{label1="label1_value", label2="label2_value", ....,
                    }
        '400':
          description: ''
          schema:
            $ref: '#/definitions/ErrorRsp'
definitions:
  ErrorRsp:
    description: 失败时返回的错误对象
    required:
      - error_code
      - error_msg
    properties:
      error_code:
        description: 错误码
        type: string
        minLength: 8
        maxLength: 36
        example: 400
      error_msg:
        description: error_msg
        type: string
        minLength: 2
        maxLength: 512
        example: request parameter error
  OperateSuccess:
    description: OperateSuccess
    type: object
    required:
      - code
      - message
      - label
    properties:
      code:
        type: string
        format: int32
        example: 200
      message:
        type: string
        example: operation succeed
      label:
        type: string
        example: Succeed
  AuthRedirectSuccess:
    description: AuthRedirectSuccess
    type: object
    required:
      - code
      - message
      - label
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string
      label:
        type: string
      data:
        type: object
        properties:
          gitee:
            type: string
        required:
          - gitee
  GetHostListReq:
    description: 前端请求查询参数,主机组名称,节点信息,排序条件,页码,分页查询数量
    properties:
      host_group_list:
        type: array
        items:
          type: string
        description: 获取指定主机组里的主机信息，为空表示所有
        example: '[]'
      search_key:
        type: string
        description: 输入主机名称或主机host_ip获取指定主机信息
        example: search_key
      management:
        type: boolean
        description: 管理节点or监控节点，不传表示所有
      status:
        type: array
        items:
          type: integer
        example: '[]'
        description: 主机状态, 不传表示所有
      sort:
        type: string
        description: 目前可选host_name或host_group_name，为空表示不排序
        example: host_name
      direction:
        type: string
        description: 排序规则,asc 或 descge
        example: asc(default)
      page:
        type: integer
        description: 当前页码
        example: 2
      per_page:
        type: integer
        description: 每页数量,最大数量50
        maximum: 50
        example: 50
    required:
      - host_group_list
  GetHostListRsp:
    description: 主机信息
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - required:
          - total_count
          - total_page
          - host_infos
        type: object
        properties:
          data:
            type: object
            properties:
              total_count:
                type: integer
                format: int32
                description: 总条数
              total_page:
                type: integer
                format: int32
                description: 总页数
              host_infos:
                type: array
                items:
                  properties:
                    host_id:
                      type: integer
                      description: 主机ID
                    host_name:
                      type: string
                      description: 主机名称
                    host_group_name:
                      type: string
                      description: 主机组名称
                    host_ip:
                      type: string
                      description: 主机IP
                    management:
                      type: string
                      description: 是否为管理节点
                    status:
                      type: string
                      description: 主机在线状态
                    scene:
                      type: string
                      description: 主机场景
                  required:
                    - host_id
                    - host_name
                    - host_group_name
                    - host_ip
                    - management
                    - status
                    - scene
                description: 主机信息
  AddHostReq:
    description: 需要添加的主机信息
    properties:
      host_name:
        type: string
        description: 主机别名
      host_group_name:
        type: string
        description: 主机组名
      host_ip:
        type: string
        description: 主机公网IP地址
      management:
        type: boolean
        description: 用作管理主机还是监控主机
        default: 'false'
      ssh_user:
        type: string
        description: 远程SSH登录用户名
        example: root
      ssh_port:
        type: integer
        description: 远程SSH登录端口
      ssh_pkey:
        type: string
        description: 远程登陆密钥
      password:
        type: string
        description: 远程SSH登录密码
        example: admin
    required:
      - host_name
      - host_group_name
      - host_ip
      - management
      - ssh_user
      - ssh_port
      - ssh_pkey
      - password
  AddHostGroupInfoReq:
    properties:
      host_group_name:
        type: string
        description: 主机组名称
      decription:
        type: string
        description: 主机组描述
    description: 添加主机组信息请求
    required:
      - host_group_name
      - decription
  HostSceneInfoRsp:
    description: 主机场景信息
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            required:
              - scene_name
              - collect_items
            type: object
            properties:
              scene_name:
                type: string
                description: 场景名称
              collect_items:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string
                description: 推荐指标列表
  ConfigList:
    properties:
      infos:
        type: array
        items:
          properties:
            host_id:
              type: integer
              description: 主机id
            config_list:
              type: array
              items:
                type: string
              description: 配置文件列表
          required:
            - host_id
            - config_list
        description: 配置文件列表
    required:
      - infos
  ConfigListRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            required:
              - resp
            properties:
              resp:
                type: array
                items:
                  properties:
                    host_id:
                      type: integer
                      description: 主机ID
                    success_files:
                      type: array
                      items:
                        type: string
                      description: 收集成功文件列表
                    fail_files:
                      type: array
                      items:
                        type: string
                      description: 收集失败文件列表
                    infos:
                      description: 信息列表
                      type: array
                      items:
                        type: object
                        properties:
                          path:
                            type: string
                            description: 文件路径
                          file_attr:
                            description: 文件属性
                            properties:
                              mode:
                                type: string
                                description: 文件mode
                              owner:
                                type: string
                                description: 文件owner
                              group:
                                type: string
                                description: 文件group
                            required:
                              - mode
                              - owner
                              - group
                          content:
                            type: string
                            description: 文件内容
                        required:
                          - path
                          - file_attr
                          - content
                  required:
                    - host_id
                    - success_files
                    - fail_files
                    - infos
                description: 响应体
  SetAgentServiceStatusReq:
    properties:
      host_id:
        type: integer
        description: 主机ID
      plugins:
        type: object
        additionalProperties:
          type: string
        description: 插件状态
    required:
      - host_id
      - plugins
  SetAgentServiceMetricStatus:
    properties:
      host_id:
        type: integer
        description: 主机ID
      plugins:
        description: 服务列表
        properties:
          gopher:
            type: object
            additionalProperties:
              type: string
  SceneListRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            required:
              - scene_list
            properties:
              scene_list:
                type: array
                items:
                  required:
                    - scene_name
                    - scene_description
                  properties:
                    scene_name:
                      type: string
                      description: 场景名称
                    scene_description:
                      type: string
                      description: 场景描述
                description: 场景列表
  AddHostGroupInfoRsp:
    description: 添加主机组信息响应
    allOf:
      - $ref: '#/definitions/OperateSuccess'
  GetHostGroupInfoRsp:
    description: 获取主机组信息响应
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            required:
              - total_count
              - total_page
              - host_group_infos
            properties:
              total_count:
                type: integer
                format: int32
                description: 总条数
                minimum: 0
              total_page:
                type: integer
                format: int32
                description: 总页数
                minimum: 0
              host_group_infos:
                type: array
                items:
                  properties:
                    host_group_name:
                      type: string
                      description: 主机组名称
                    description:
                      type: string
                      description: 主机组描述
                    host_count:
                      type: integer
                      format: int32
                      description: 主机个数
                  required:
                    - host_group_name
                    - description
                    - host_count
                description: 主机组信息
  UserLoginRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              token:
                type: string
                description: 有效身份验证的token
              refresh_token:
                type: string
                description: 获取新token的刷新token，相比token有效期更长
            required:
              - token
              - refresh_token
  GetHostBasicInfoRsp:
    description: 查询主机基本信息响应
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - required:
          - host_infos
        type: object
        properties:
          data:
            type: object
            properties:
              host_infos:
                type: array
                items:
                  properties:
                    host_id:
                      type: integer
                      description: 主机ID
                    infos:
                      description: 信息列表
                      properties:
                        os:
                          description: OS信息
                          properties:
                            kernel_version:
                              type: string
                              description: 内核版本
                            bios_version:
                              type: string
                              description: bios版本
                            name:
                              type: string
                              description: 名称
                          required:
                            - kernel_version
                            - bios_version
                            - name
                        cpu:
                          description: cpu信息
                          required:
                            - architecture
                            - core_count
                            - model_name
                            - vendor_id
                            - l1d_cache
                            - l1i_cache
                            - l2_cache
                            - l3_cache
                          properties:
                            architecture:
                              type: string
                              description: 架构
                            core_count:
                              type: string
                              description: 核数
                            model_name:
                              type: string
                              description: 模式名称
                            vendor_id:
                              type: string
                              description: 厂商ID
                            l1d_cache:
                              type: string
                              description: 1级数据缓存大小
                            l1i_cache:
                              type: string
                              description: 1级指令缓存大小
                            l2_cache:
                              type: string
                              description: 2级缓存大小
                            l3_cache:
                              type: string
                              description: 3级缓存大小
                        memory:
                          description: 内存信息
                          required:
                            - size
                            - total
                            - info
                          properties:
                            size:
                              type: string
                              description: 大小
                            total:
                              type: integer
                              format: int32
                              description: 总大小
                            info:
                              type: array
                              items:
                                properties:
                                  size:
                                    type: string
                                    description: 大小
                                  type:
                                    type: string
                                    description: 类型
                                  speed:
                                    type: string
                                    description: 速度
                                  manufacturer:
                                    type: string
                                    description: 厂商
                                required:
                                  - size
                                  - type
                                  - speed
                                  - manufacturer
                              description: 信息
                      required:
                        - os
                        - cpu
                        - memory
                  required:
                    - host_id
                    - infos
                description: 主机基本信息
  SetAgentServiceResourceReq:
    description: 设置agent服务资源消耗
    properties:
      host_id:
        type: integer
        description: 主机ID
      agent_source:
        description: agent资源设置
        required:
          - cpu
          - mem
        properties:
          cpu:
            type: integer
            format: int32
            description: cpu资源
          mem:
            type: integer
            format: int32
            description: mem资源
      plugin_resource:
        type: array
        items:
          properties:
            plugin_name:
              description: 插件名称
              required:
                - cpu
                - mem
              properties:
                cpu:
                  type: integer
                  format: int32
                  description: cpu资源
                mem:
                  type: integer
                  format: int32
                  description: mem资源
          required:
            - plugin_name
        description: 插件资源设置
    required:
      - host_id
      - agent_source
      - plugin_resource
  GetHostTokenRsp:
    description: 获取主机token响应
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              host_token:
                type: string
                description: 用户的主机token
            required:
              - host_token
  InstallAgentPluginReq:
    description: 安装agent插件
    properties:
      plugin_name:
        type: string
        description: 插件名称
      plugin_config:
        type: string
        description: 插件配置
      start:
        type: boolean
        description: 是否启动
      rpm_name:
        type: string
        description: rpm包名称
      rpm_version:
        type: string
        description: rpm包版本
    required:
      - plugin_name
      - plugin_config
      - start
      - rpm_name
      - rpm_version
  GetAgentPluginInfoRsp:
    description: 获取agent插件信息响应
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              info:
                items:
                  $ref: '#/definitions/PluginInfo'
                description: 插件信息
                type: array
  DeleteGroupRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              deleted:
                type: array
                items:
                  type: string
  DeleteHostRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              succeed_list:
                type: array
                items:
                  type: integer
              fail_list:
                type: array
                items:
                  type: integer
  PluginInfo:
    properties:
      plugin_name:
        type: string
      is_installed:
        type: boolean
      status:
        type: string
      collect_items:
        type: array
        items:
          $ref: '#/definitions/CollectItems'
      resource:
        items:
          $ref: '#/definitions/Resource'
        type: array
  CollectItems:
    properties:
      probe_name:
        type: string
      probe_status:
        type: string
      support_auto:
        type: boolean
  Resource:
    properties:
      name:
        type: string
      limit_value:
        type: string
      current_value:
        type: string
  CveTaskBasicInfo:
    properties:
      task_id:
        type: string
        example: 2565b698731811ee86ea525400d24fe7
      task_name:
        type: string
      task_type:
        type: string
        description: 任务类型repo set,cve scan或cve fix
      total_hosts:
        type: array
        items:
          type: integer
        example: [1,2,3,4]
      callback:
        type: string
        example: /vulnerability/task/callback/cve/xxx
    required:
      - task_id
      - task_name
      - task_type
      - total_hosts
      - callback
  CveCheckItems:
    type: object
    properties:
      check_items:
        type: array
        items:
          type: string
          example: network

  RepoSetReq:
    allOf:
      - $ref: '#/definitions/CveTaskBasicInfo'
      - $ref: '#/definitions/CveCheckItems'
      - type: object
        properties:
          repo_info:
            properties:
              name:
                type: string
                example: aops-update
              dest:
                type: string
                example: /etc/yum.repos.d/aops-update.repo
              repo_content:
                type: string
                example: |
                  [aops-update]
                  name=update
                  baseurl=http://repo.openeuler.org/openEuler-22.03-LTS/update/$basearch/
                  enabled=1
                  gpgcheck=1
                  gpgkey=http://repo.openeuler.org/openEuler-22.03-LTS/OS/$basearch/RPM-GPG-KEY-openEuler
            required:
              - name
              - dest
              - repo_content
        required:
          - repo_info

  CveScanReq:
    allOf:
      - $ref: '#/definitions/CveTaskBasicInfo'
      - $ref: '#/definitions/CveCheckItems'
  
  CveFixRpmInfo:
    type: object
    properties:
      installed_rpm:
        type: string
        example: zlib-1.2.11-19.oe2203.x86_64
      available_rpm:
        type: string
        example: zlib-1.2.11-22.oe2203.x86_64
      fix_way:
        type: string
        example: hotpatch or coldpatch
      
  FixedTaskCveInfo:
    type: object
    description: 需要修复的CVE信息
    properties:
      host_id: 
        type: integer
        example: 1
      cves:
        type: array
        items:
          type: object
          properties:
            cve_id:
              type: string
              example: CVE-2022-37434
            rpms:
              type: array
              items:
                $ref: '#/definitions/CveFixRpmInfo'
    
  CveFixReq:
    allOf:
    - $ref: '#/definitions/CveTaskBasicInfo'
    - $ref: '#/definitions/CveCheckItems'
    - properties:
        tasks:
          type: array
          items:
           $ref: '#/definitions/FixedTaskCveInfo'
        accepted:
          type: boolean
          description: 是否将热补丁设置为accept状态
        takeover:
          type: boolean
          description: 是否收编冷补丁
  RollBackTaskInfo:
    type: object
    properties:
      host_id: 
        type: integer
        example: 0
      cves:
        type: array
        items:
          type: object
          properties:
            cve_id:
              type: string
            hotpatch:
              type: boolean
  CveRollBackReq:
    allOf:
    - $ref: '#/definitions/CveTaskBasicInfo'
    - properties:
        tasks:
          type: array
          items:
           $ref: '#/definitions/RollBackTaskInfo'
  SetAgentServiceStatusRsp:
    type: object
    description: 设置agent服务状态返回结果
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            required:
              - failed_list
              - succeed_list
            properties:
              failed_list:
                type: array
                items:
                  type: string
                description: 设置失败的服务名
              succeed_list:
                type: array
                items:
                  type: string
                description: 设置成功的服务名
  SetAgentPluginProbeRsp:
    type: object
    description: 设置agent采集插件的采集项状态返回体
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            required:
              - resp
            properties:
              resp:
                type: object
                additionalProperties:
                  $ref: '#/definitions/SetPluginProbeStatus'
  SetPluginProbeStatus:
    type: object
    description: 单个插件的采集项状态设置的结果
    required:
      - failure
      - success
    properties:
      failure:
        type: array
        items:
          type: string
        description: 设置失败的探针/采集项名称
      success:
        type: array
        items:
          type: string
        description: 设置成功的探针/采集项名称
  GetHostCountRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              host_count:
                type: integer
  AddHostBatchReq:
    type: object
    required:
      - host_list
    properties:
      host_list:
        type: array
        items:
          type: object
          properties:
            host_name:
              type: string
              description: 主机名
            host_group_name:
              type: string
              description: 主机组名称
            host_ip:
              type: string
              description: 主机IP
            ssh_port:
              type: integer
              description: ssh登录端口
            ssh_user:
              type: string
              description: SSH登录用户名
            password:
              type: string
              description: 密码
            management:
              type: boolean
              description: 是否为管理节点主机
  AddHostBatchRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              result:
                type: array
                items:
                  type: object
                  properties:
                    host_name:
                      type: string
                      description: 主机名
                    host_group_name:
                      type: string
                      description: 主机组名称
                    host_ip:
                      type: string
                      description: 主机IP
                    ssh_port:
                      type: integer
                      description: ssh登录端口
                    ssh_user:
                      type: string
                      description: SSH登录用户名
                    management:
                      type: boolean
                      description: 是否为管理节点主机
                    result:
                      type: string
                      description: 添加结果
                    reason:
                      type: string
                      description: 添加失败原因
  host_template_file:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              template:
                type: string
                format: binary
                description: 模板文件
  UpdateHostReq:
    type: object
    properties:
      host_id:
        type: integer
        description: 主机ID
      host_name:
        type: string
        description: 主机名
      host_group_name:
        type: string
        description: 主机组名称
      ssh_port:
        type: integer
        description: ssh登录端口
      ssh_user:
        type: string
        description: SSH登录用户名
      password:
        type: string
        description: 密码
      management:
        type: boolean
        description: 是否为管理节点主机
    required: 
      - host_id
  SyncConfigReq:
    type: object
    properties: 
      host_id:
        type: integer
        description: 主机ID
        example: 1
      file_path:
        type: string
        description: 需要同步的文件路径
      content:
        type: string
        description: 需要同步的文件内容
    required:
      - host_id
      - file_path
      - content
  SyncConfigResult:
    type: object
    properties:
      file_path:
        type: string
        example: '/etc/ssh/sshd_config'
      sync_result:
        type: boolean
        example: true
  SyncConfigRsp:
    allOf:
      - $ref: '#/definitions/OperateSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              resp:
                $ref: '#/definitions/SyncConfigResult'
  QueryMetricDataInfo:
    type: object
    description: 指定查询信息
    required:
      - time_range
      - query_info
      - query_ip
    properties:
      time_range:
        type: array
        items:
          type: integer
          format: int32
        example:
          - 1665360266
          - 1665371066
        description: 时间范围
      query_ip:
        type: string
        example: 127.0.0.1
      query_info:
        description: 查询标签信息
        properties:
          metric1:
            type: array
            items:
              type: string
            example:
              - 'metric1{label1="label1_value", label2="label2_value", ...., }'
              - 'metric1{label1="label1_value", label2="label2_value", ...., }'
          metric2:
            type: array
            items:
              type: string
            example:
              - 'metric2{label1="label1_value", label2="label2_value", ...., }'
              - 'metric2{label1="label1_value", label2="label2_value", ...., }'
